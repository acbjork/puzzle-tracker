<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üß† I'm Puzzled ‚ÄºÔ∏è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: system-ui, sans-serif; margin: 1em; }
    h1, .subtitle { text-align: center; margin: 0; }
    .subtitle { font-size: 0.95em; color: #555; margin-top: 0.2em; margin-bottom: 2em; }
    .user-select-area { margin-top: 1em; margin-bottom: 3em; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; vertical-align: top; text-align: center; }
    th:first-child, td:first-child { text-align: left; }
    textarea { width: 95%; box-sizing: border-box; }
    .submitted { white-space: pre-wrap; background: transparent; padding: 0.25em 0.5em; line-height: 1.2; border-radius: 4px; }
    .winner { background-color: #d6f5d6 !important; }
    .tie { background-color: #fff9c4 !important; }
    .version { text-align: right; font-size: 0.85em; color: #888; margin-top: 2em; }
    
    #scoreboard { margin: 1em 0; display: flex; justify-content: space-around; font-family: monospace; font-size: 1.5em; position: relative; }
    .scoreboard-label { font-weight: bold; text-align: center; position: relative; }
    .scoreboard-value { display: block; font-size: 1.5em; }
    .crown { position: absolute; top: -40px; left: 50%; transform: translateX(-50%); font-size: 2em; animation: crownBounce 1s ease-in-out infinite alternate; }
    @keyframes crownBounce { 0% { transform: translateX(-50%) translateY(0px); } 100% { transform: translateX(-50%) translateY(-5px); } }

    #loadingOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; color: #444; font-size: 1.5em; display: flex; align-items: center; justify-content: center; z-index: 9999; }

    .button-container { display: flex; justify-content: space-between; align-items: center; margin: 1em 0; }
    .button-container > div { flex: 1; }
    .button-container > div:first-child { text-align: left; }
    .button-container > div:last-child { text-align: right; }

    .chat-modal, .history-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; display: none; backdrop-filter: blur(4px); }
    .chat-window, .history-window { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 500px; height: 80%; max-height: 600px; background: white; border-radius: 12px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); display: flex; flex-direction: column; overflow: hidden; }
    .chat-header, .history-header { background: linear-gradient(135deg, #cc5500, #4a4a4a); color: white; padding: 1em; font-weight: bold; font-size: 1.1em; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); position: relative; }
    .history-header { background: linear-gradient(135deg, #6b46c1, #8b5cf6); }
    .chat-close-btn, .history-close-btn { position: absolute; top: 50%; right: 1em; transform: translateY(-50%); background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; }
    .chat-close-btn:hover, .history-close-btn:hover { background: rgba(255, 255, 255, 0.2); }
    .chat-messages { flex: 1; overflow-y: auto; padding: 1em; background: #f9f9f9; -webkit-overflow-scrolling: touch; }
    .history-content { flex: 1; overflow-y: auto; padding: 1.5em; background: #f9f9f9; -webkit-overflow-scrolling: touch; }
    .chat-message { margin-bottom: 1em; display: flex; align-items: flex-start; animation: messageSlide 0.3s ease-out; position: relative; }
    @keyframes messageSlide { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .chat-message.current-user { justify-content: flex-end; }
    .chat-message.other-user { justify-content: flex-start; }
    .message-bubble { max-width: 75%; padding: 0.75em 1em; border-radius: 18px; word-wrap: break-word; position: relative; cursor: pointer; transition: transform 0.1s; }
    .message-bubble:hover { transform: scale(1.02); }
    .message-bubble.current-user { background: #cc5500; color: white; border-bottom-right-radius: 4px; }
    .message-bubble.other-user { background: #e5e5e5; color: black; border-bottom-left-radius: 4px; }
    .message-bubble.deleted { background: #f0f0f0 !important; color: #888 !important; font-style: italic; opacity: 0.7; cursor: default; }
    .message-bubble.deleted:hover { transform: none; }
    .sender { font-weight: bold; font-size: 0.8em; margin-bottom: 0.25em; opacity: 0.8; }
    .message-text { font-size: 0.9em; line-height: 1.3; }
    .timestamp { font-size: 0.7em; opacity: 0.7; margin-top: 0.25em; }
    .chat-input-area { padding: 1em; background: white; border-top: 1px solid #ddd; display: flex; gap: 0.5em; align-items: flex-end; }
    .chat-input { flex: 1; padding: 0.75em; border: 2px solid #ff6b35; border-radius: 20px; font-size: 0.9em; resize: none; min-height: 40px; max-height: 80px; outline: none; transition: border-color 0.2s; }
    .chat-input:focus { border-color: #ff6b35; }
    .chat-send-btn { background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; font-size: 1.2em; transition: transform 0.2s, box-shadow 0.2s; display: flex; align-items: center; justify-content: center; }
    .chat-send-btn:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4); }
    .chat-send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
    .chat-empty { text-align: center; color: #888; font-style: italic; padding: 2em; }
    .unread-indicator { position: absolute; top: -5px; right: -5px; background: #ff4757; color: white; border-radius: 50%; min-width: 20px; height: 20px; font-size: 0.7em; display: flex; align-items: center; justify-content: center; font-weight: bold; animation: pulse 2s infinite; padding: 0 4px; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    .chat-toggle, .history-toggle { position: relative; color: white; border: none; padding: 0.75em 1.5em; border-radius: 25px; cursor: pointer; font-weight: bold; margin: 1em 0; transition: all 0.3s; }
    .chat-toggle { background: linear-gradient(135deg, #667eea, #764ba2); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
    .history-toggle { background: linear-gradient(135deg, #6b46c1, #8b5cf6); box-shadow: 0 4px 15px rgba(107, 70, 193, 0.3); }
    .chat-toggle:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
    .history-toggle:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(107, 70, 193, 0.4); }
    .delete-confirmation { position: absolute; top: -40px; right: 0; background: #ff4757; color: white; padding: 0.5em; border-radius: 8px; font-size: 0.8em; white-space: nowrap; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
    .delete-confirmation button { background: white; color: #ff4757; border: none; padding: 0.25em 0.5em; margin: 0 0.25em; border-radius: 4px; cursor: pointer; font-size: 0.8em; }

    .overall-winner { background: linear-gradient(135deg, #ffd700, #ffed4e); padding: 1.5em; border-radius: 12px; margin-bottom: 1.5em; text-align: center; box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3); }
    .overall-winner h3 { margin: 0 0 0.5em 0; font-size: 1.3em; color: #b8860b; }
    .overall-winner .winner-name { font-size: 1.8em; font-weight: bold; color: #8b4513; margin: 0.25em 0; }
    .overall-winner .streak { font-size: 1.2em; color: #8b4513; margin: 0.25em 0; }
    .puzzle-winners { background: white; border-radius: 8px; padding: 1em; }
    .puzzle-winners h4 { margin: 0 0 1em 0; color: #666; font-size: 1em; text-align: center; }
    .puzzle-winner-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5em 0; border-bottom: 1px solid #eee; }
    .puzzle-winner-item:last-child { border-bottom: none; }
    .puzzle-name { font-weight: bold; color: #333; }
    .puzzle-streak { color: #666; font-size: 0.9em; }

    @media (max-width: 768px) {
      body { margin: 0.5em; }
      table { font-size: 0.8em; }
      th:first-child, td:first-child { width: 25%; max-width: 80px; word-wrap: break-word; line-height: 1.2; }
      th:nth-child(2), th:nth-child(3), td:nth-child(2), td:nth-child(3) { width: 37.5%; }
      .submitted { font-size: 0.85em; line-height: 1.1; padding: 0.2em 0.4em; }
      #scoreboard { font-size: 1.2em; flex-wrap: wrap; gap: 0.5em; }
      .chat-window, .history-window { width: 98%; height: 95%; max-width: none; }
      .chat-messages, .history-content { padding: 0.75em; }
      .message-bubble { max-width: 85%; padding: 0.6em 0.8em; }
      textarea { width: 92%; }
      .button-container { flex-direction: column; gap: 0.5em; }
      .button-container > div { text-align: center; }
    }

    @media (max-width: 480px) {
      h1 { font-size: 1.5em; }
      .subtitle { font-size: 0.85em; }
      th:first-child, td:first-child { width: 20%; max-width: 60px; font-size: 0.75em; }
      .submitted { font-size: 0.75em; }
      #scoreboard { font-size: 1em; }
      .scoreboard-value { font-size: 1.2em; }
      .chat-window, .history-window { width: 100%; height: 100%; border-radius: 0; top: 0; left: 0; transform: none; }
    }
  </style>
</head>
<body>
  <div id="loadingOverlay">Loading‚Ä¶</div>
  <h1>üß† I'm Puzzled ‚ÄºÔ∏è</h1>
  <div class="subtitle">If you ain't first, you're last</div>

  <div class="user-select-area">
    <label for="userSelect">Signed in as:
      <select id="userSelect">
        <option value="">(choose)</option>
        <option value="Adam">Adam üåµ</option>
        <option value="Jonathan">Jonathan üí©</option>
      </select>
    </label>
  </div>

  <div id="scoreboard">
    <div class="scoreboard-label">ACB
      <span id="acbCrown" class="crown" style="display: none;">üëë</span>
      <span id="acbCount" class="scoreboard-value">0</span>
    </div>
    <div class="scoreboard-label">JBB
      <span id="jbbCrown" class="crown" style="display: none;">üëë</span>
      <span id="jbbCount" class="scoreboard-value">0</span>
    </div>
    <div class="scoreboard-label">Tie<span id="tieCount" class="scoreboard-value">0</span></div>
    <div class="scoreboard-label">Remaining<span id="remainingCount" class="scoreboard-value">10</span></div>
  </div>

  <div class="button-container">
    <div>
      <button id="chatToggle" class="chat-toggle" style="display: none;">
        üí¨ Trash Talk Central üóëÔ∏è
        <span id="unreadBadge" class="unread-indicator" style="display: none;">0</span>
      </button>
    </div>
    <div>
      <button id="historyToggle" class="history-toggle" style="display: none;">
        üß© History üìä
      </button>
    </div>
  </div>

  <div class="chat-modal" id="chatModal">
    <div class="chat-window">
      <div class="chat-header">
        üí¨ Trash Talk Central üóëÔ∏è
        <button class="chat-close-btn" id="chatCloseBtn">‚úï</button>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="chat-empty">No trash talk yet... someone needs to start the smack down! üî•</div>
      </div>
      <div class="chat-input-area">
        <textarea id="chatInput" class="chat-input" placeholder="Drop some trash talk here..." maxlength="500" disabled></textarea>
        <button id="chatSendBtn" class="chat-send-btn" disabled>üöÆ</button>
      </div>
    </div>
  </div>

  <div class="history-modal" id="historyModal">
    <div class="history-window">
      <div class="history-header">
        üß© History üìä
        <button class="history-close-btn" id="historyCloseBtn">‚úï</button>
      </div>
      <div class="history-content" id="historyContent">
        <div class="overall-winner">
          <h3>Last Daily Winner</h3>
          <div class="winner-name" id="lastOverallWinner">Loading...</div>
          <div class="streak" id="overallStreak">Calculating streak...</div>
        </div>
        <div class="puzzle-winners">
          <h4>Individual Puzzle Streaks</h4>
          <div id="puzzleStreaks">Loading puzzle streaks...</div>
        </div>
      </div>
    </div>
  </div>

  <table id="puzzleTable">
    <thead>
      <tr><th>Puzzle</th><th>Adam üåµ</th><th>Jonathan üí©</th></tr>
    </thead>
    <tbody id="puzzleRows">
      <tr data-puzzle="Connections"><td>Connections</td><td data-cell="Connections-Adam"></td><td data-cell="Connections-Jonathan"></td></tr>
      <tr data-puzzle="Strands"><td>Strands</td><td data-cell="Strands-Adam"></td><td data-cell="Strands-Jonathan"></td></tr>
      <tr data-puzzle="On The Record"><td>On The Record</td><td data-cell="On The Record-Adam"></td><td data-cell="On The Record-Jonathan"></td></tr>
      <tr data-puzzle="Keyword"><td>Keyword</td><td data-cell="Keyword-Adam"></td><td data-cell="Keyword-Jonathan"></td></tr>
      <tr data-puzzle="NYT Mini"><td>NYT Mini</td><td data-cell="NYT Mini-Adam"></td><td data-cell="NYT Mini-Jonathan"></td></tr>
      <tr data-puzzle="Apple Mini"><td>Apple Mini</td><td data-cell="Apple Mini-Adam"></td><td data-cell="Apple Mini-Jonathan"></td></tr>
      <tr data-puzzle="Globle"><td>Globle</td><td data-cell="Globle-Adam"></td><td data-cell="Globle-Jonathan"></td></tr>
      <tr data-puzzle="Flagle"><td>Flagle</td><td data-cell="Flagle-Adam"></td><td data-cell="Flagle-Jonathan"></td></tr>
      <tr data-puzzle="Wordle"><td>Wordle</td><td data-cell="Wordle-Adam"></td><td data-cell="Wordle-Jonathan"></td></tr>
      <tr data-puzzle="Tightrope"><td>Tightrope</td><td data-cell="Tightrope-Adam"></td><td data-cell="Tightrope-Jonathan"></td></tr>
    </tbody>
  </table>

  <div class="version">v0.6.0 - History tracking, improved unread badges & better styling! üéØ</div>

  <script>
    // JavaScript will be inserted via external file due to length limitations
    // This includes all the Supabase integration, chat functionality, and history tracking
    
    alert("This HTML file needs the JavaScript code added separately due to size constraints. The complete working version requires all the JavaScript functions for Supabase, chat, history tracking, and puzzle logic.");
  </script>
</body>
</html>