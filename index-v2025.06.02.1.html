// CROSS-STRIP CLOSING + SEPARATE OPEN ACTIONS
// REPLACE your existing toggleTopStrip and toggleBottomStrip functions with these:

function toggleTopStrip() {
  // If bottom strip (trash talk) is expanded, close it when tapping top strip
  if (bottomStripExpanded && !topStripExpanded) {
    console.log('üîΩ Closing trash talk by tapping top strip');
    executeBottomStripClose();
    return; // Don't open top strip yet - user must tap again
  }
  
  // If top strip is already expanded, close it (normal collapse)
  if (topStripExpanded) {
    console.log('üîù Closing history & stats (normal collapse)');
    executeTopStripClose();
    return;
  }
  
  // If nothing is expanded, open top strip
  console.log('üîù Opening history & stats');
  executeTopStripOpen();
}

function toggleBottomStrip() {
  // If top strip (history) is expanded, close it when tapping bottom strip
  if (topStripExpanded && !bottomStripExpanded) {
    console.log('üîù Closing history & stats by tapping bottom strip');
    executeTopStripClose();
    return; // Don't open bottom strip yet - user must tap again
  }
  
  // If bottom strip is already expanded, close it (normal collapse)
  if (bottomStripExpanded) {
    console.log('üîΩ Closing trash talk (normal collapse)');
    executeBottomStripClose();
    return;
  }
  
  // If nothing is expanded, open bottom strip
  console.log('üîΩ Opening trash talk');
  executeBottomStripOpen();
}

// ADD: Cross-strip closing for expanded strip top/bottom areas
function handleTopStripCollapse(e) {
  // This handles tapping the top area of trash talk to close it
  if (bottomStripExpanded) {
    console.log('üîΩ Closing trash talk by tapping its top area');
    executeBottomStripClose();
    return;
  }
  
  // If top strip is expanded, tapping its own area closes it
  if (topStripExpanded) {
    console.log('üîù Closing history & stats by tapping its area');
    executeTopStripClose();
    return;
  }
}

function handleBottomStripCollapse(e) {
  // This handles tapping the bottom area of history to close it
  if (topStripExpanded) {
    console.log('üîù Closing history & stats by tapping its bottom area');
    executeTopStripClose();
    return;
  }
  
  // If bottom strip is expanded, tapping its own area closes it
  if (bottomStripExpanded) {
    console.log('üîΩ Closing trash talk by tapping its area');
    executeBottomStripClose();
    return;
  }
}

// SAME OPEN/CLOSE FUNCTIONS (no changes)
function executeTopStripOpen() {
  const topStrip = document.getElementById('topStrip');
  const mainContent = document.getElementById('mainContent');
  
  topStrip.classList.add('expanded');
  mainContent.style.marginTop = '60vh';
  topStripExpanded = true;
  showOverlay();
  loadHistoryData();
  updateCurrentChampDisplay();
  
  console.log('‚úÖ History & Stats opened');
}

function executeTopStripClose() {
  const topStrip = document.getElementById('topStrip');
  const mainContent = document.getElementById('mainContent');
  
  topStrip.classList.remove('expanded');
  mainContent.style.marginTop = '110px';
  topStripExpanded = false;
  hideOverlay();
  
  console.log('‚úÖ History & Stats closed');
}

function executeBottomStripOpen() {
  const bottomStrip = document.getElementById('bottomStrip');
  const mainContent = document.getElementById('mainContent');
  
  bottomStrip.classList.add('expanded');
  mainContent.style.marginBottom = '70vh';
  bottomStripExpanded = true;
  showOverlay();
  loadChatMessages();
  
  console.log('‚úÖ Trash Talk opened');
}

function executeBottomStripClose() {
  const bottomStrip = document.getElementById('bottomStrip');
  const mainContent = document.getElementById('mainContent');
  
  bottomStrip.classList.remove('expanded');
  mainContent.style.marginBottom = '70px';
  bottomStripExpanded = false;
  hideOverlay();
  
  console.log('‚úÖ Trash Talk closed');
}

// ENHANCED TAP ZONE MANAGEMENT - Add collapse zones for expanded strips
function updateTapZones() {
  const topExpandZone = document.getElementById('topExpandZone');
  const bottomExpandZone = document.getElementById('bottomExpandZone');
  
  // CREATE COLLAPSE ZONES if they don't exist
  let topCollapseZone = document.getElementById('topCollapseZone');
  let bottomCollapseZone = document.getElementById('bottomCollapseZone');
  
  if (!topCollapseZone) {
    topCollapseZone = document.createElement('div');
    topCollapseZone.id = 'topCollapseZone';
    topCollapseZone.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      z-index: 1003;
      cursor: pointer;
      background: transparent;
      display: none;
    `;
    topCollapseZone.addEventListener('click', handleTopStripCollapse);
    topCollapseZone.addEventListener('touchend', handleTopStripCollapse);
    document.body.appendChild(topCollapseZone);
  }
  
  if (!bottomCollapseZone) {
    bottomCollapseZone = document.createElement('div');
    bottomCollapseZone.id = 'bottomCollapseZone';
    bottomCollapseZone.style.cssText = `
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 80px;
      z-index: 1003;
      cursor: pointer;
      background: transparent;
      display: none;
    `;
    bottomCollapseZone.addEventListener('click', handleBottomStripCollapse);
    bottomCollapseZone.addEventListener('touchend', handleBottomStripCollapse);
    document.body.appendChild(bottomCollapseZone);
  }
  
  // MANAGE ZONE VISIBILITY
  if (topStripExpanded) {
    // History is open: hide top expand zone, show bottom collapse zone
    if (topExpandZone) topExpandZone.style.display = 'none';
    if (bottomExpandZone) bottomExpandZone.style.display = 'none';
    topCollapseZone.style.display = 'none'; // Don't show top collapse (use cross-strip)
    bottomCollapseZone.style.display = 'block'; // Show bottom for closing history
    console.log('üîù History expanded - bottom zone can close it');
    
  } else if (bottomStripExpanded) {
    // Trash talk is open: hide bottom expand zone, show top collapse zone
    if (topExpandZone) topExpandZone.style.display = 'none';
    if (bottomExpandZone) bottomExpandZone.style.display = 'none';
    topCollapseZone.style.display = 'block'; // Show top for closing trash talk
    bottomCollapseZone.style.display = 'none'; // Don't show bottom collapse (use cross-strip)
    console.log('üîΩ Trash talk expanded - top zone can close it');
    
  } else {
    // Nothing expanded: show expand zones, hide collapse zones
    if (topExpandZone) topExpandZone.style.display = 'block';
    if (bottomExpandZone) bottomExpandZone.style.display = 'block';
    topCollapseZone.style.display = 'none';
    bottomCollapseZone.style.display = 'none';
    console.log('‚ú® Nothing expanded - expand zones active');
  }
}

// Hook into existing toggle functions to update zones
const originalToggleTopStrip = window.toggleTopStrip;
const originalToggleBottomStrip = window.toggleBottomStrip;

window.toggleTopStrip = function() {
  toggleTopStrip(); // Call our new function
  setTimeout(updateTapZones, 100);
};

window.toggleBottomStrip = function() {
  toggleBottomStrip(); // Call our new function  
  setTimeout(updateTapZones, 100);
};

// Initialize zones
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(updateTapZones, 500); // Initial setup
});